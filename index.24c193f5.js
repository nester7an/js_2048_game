!function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,r=Array(t);a<t;a++)r[a]=e[a];return r}function a(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,a){if(e){if("string"==typeof e)return t(e,void 0);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return t(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var r=new(function(){var t,r;function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),this.state=e,this.initialState=e,this.status="idle",this.score=0}return t=[{key:"canCellsMove",value:function(e){for(var t=0;t<4;t++)for(var a=0;a<4;a++)if(0===e[t][a])return!0;for(var r=0;r<4;r++)for(var n=0;n<4;n++){var s=e[r][n];if(n<3&&s===e[r][n+1]||r<3&&s===e[r+1][n])return!0}return!1}},{key:"cellsMergeValues",value:function(e,t){var a=e+t;return this.score+=a,[a,0]}},{key:"moveLeft",value:function(){var e=this;if("playing"===this.status){var t=this.getState();this.state=this.state.map(function(t){var r=a(t),s=n.ifEqualSeeEach(r)[0],i=n.ifEqualSeeEach(r)[1];if(s){var o=e.cellsMergeValues(r[i[0]],r[i[1]]);if(r[i[0]]=o[0],r[i[1]]=o[1],4===i.length){var l=e.cellsMergeValues(r[i[2]],r[i[3]]);r[i[2]]=l[0],r[i[3]]=l[1]}}return n.cellsMoveValues(r)});var r=this.getState();n.are2DArraysEqual(t,r)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}},{key:"moveRight",value:function(){var e=this;if("playing"===this.status){var t=this.getState();this.state=this.state.map(function(t){var r=a(t).reverse(),s=n.ifEqualSeeEach(r)[0],i=n.ifEqualSeeEach(r)[1];if(s){var o=e.cellsMergeValues(r[i[0]],r[i[1]]);if(r[i[0]]=o[0],r[i[1]]=o[1],4===i.length){var l=e.cellsMergeValues(r[i[2]],r[i[3]]);r[i[2]]=l[0],r[i[3]]=l[1]}}return n.cellsMoveValues(r).reverse()});var r=this.getState();n.are2DArraysEqual(t,r)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}},{key:"moveUp",value:function(){var e=this;if("playing"===this.status){var t=this.getState(),a=this.state,r=n.transposeMatrix(a).map(function(t){var a=n.ifEqualSeeEach(t)[0],r=n.ifEqualSeeEach(t)[1];if(a){var s=e.cellsMergeValues(t[r[0]],t[r[1]]);if(t[r[0]]=s[0],t[r[1]]=s[1],4===r.length){var i=e.cellsMergeValues(t[r[2]],t[r[3]]);t[r[2]]=i[0],t[r[3]]=i[1]}}return n.cellsMoveValues(t)});this.state=n.transposeMatrix(r);var s=this.getState();n.are2DArraysEqual(t,s)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}},{key:"moveDown",value:function(){var e=this,t=this.getState();if("playing"===this.status){var r=this.state,s=n.transposeMatrix(r).map(function(t){var r=a(t).reverse(),s=n.ifEqualSeeEach(r)[0],i=n.ifEqualSeeEach(r)[1];if(s){var o=e.cellsMergeValues(r[i[0]],r[i[1]]);if(r[i[0]]=o[0],r[i[1]]=o[1],4===i.length){var l=e.cellsMergeValues(r[i[2]],r[i[3]]);r[i[2]]=l[0],r[i[3]]=l[1]}}return n.cellsMoveValues(r).reverse()});this.state=n.transposeMatrix(s);var i=this.getState();n.are2DArraysEqual(t,i)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.state}},{key:"getStatus",value:function(){return this.status}},{key:"start",value:function(){this.status="playing",this.addRandomStartCells()}},{key:"restart",value:function(){this.status="idle",this.state=this.initialState,this.score=0}},{key:"addRandomCell",value:function(){var e=this.getState().flat(),t=[];if(e.forEach(function(e,a){0===e&&t.push(a)}),t.length>0){var a=Math.floor(Math.random()*t.length),r=t[a],s=0;s=.1>=Math.random()?4:2,e[r]=s,this.state=n.convertTo2DArray(e)}}},{key:"addRandomStartCells",value:function(){var e=this.getState().flat(),t=[];if(e.forEach(function(e,a){0===e&&t.push(a)}),t.length>0){var a=Math.floor(Math.random()*t.length),r=t[a];t.splice(a,1);var s=Math.floor(Math.random()*t.length),i=t[s],o=0,l=0;o=.5>=Math.random()?4:2,l=.5>=Math.random()?4:2,e[r]=o,e[i]=l,this.state=n.convertTo2DArray(e)}}}],r=[{key:"transposeMatrix",value:function(e){return e[0].map(function(t,a){return e.map(function(e){return e[a]})})}},{key:"ifEqualSeeEach",value:function(e){for(var t=!1,a=[],r=e.every(function(t){return t===e[0]&&0!==e[0]}),n=0;n<e.length-1;n+=1){var s=n+1;if(0===e[s]&&0===e[++s]&&s++,e[n]===e[s]&&0!==e[n]){if(t=!0,a.push(n),a.push(s),!r&&!(e[0]===e[1]&&e[2]===e[3]))break;n++}}return[t,a]}},{key:"convertTo2DArray",value:function(e){for(var t=[],a=0;a<4;a++)t.push(e.slice(4*a,4*a+4));return t}},{key:"cellsMoveValues",value:function(e){var t=0,r=a(e);return r.forEach(function(e,a,n){0!==e&&(t!==a&&(r[t]=e,n[a]=0),t++)}),r}},{key:"are2DArraysEqual",value:function(e,t){return e.length===t.length&&e.every(function(e,a){var r=t[a];return e.length===r.length&&e.every(function(e,t){return e===r[t]})})}}],t&&e(n.prototype,t),r&&e(n,r),n}())([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),n=document.querySelector(".game-field tbody"),s=document.querySelector(".game-header").querySelector(".button"),i=document.querySelector(".game-score");function o(){n.innerHTML="",r.getState().forEach(function(e){var t=document.createElement("tr");t.classList.add("field-row"),e.forEach(function(e){var a=document.createElement("td");a.classList.add("field-cell"),e>0&&a.classList.add("field-cell--".concat(e)),a.textContent=0===e?"":e,t.appendChild(a)}),n.appendChild(t)}),i.textContent="".concat(r.getScore())}function l(){"win"===r.getStatus()&&(document.removeEventListener("keydown",f),document.removeEventListener("keydown",v),document.removeEventListener("keydown",d),document.removeEventListener("keydown",h),document.querySelector(".message-win").classList.remove("hidden"))}function u(){document.querySelector(".message-lose").classList.remove("hidden")}function c(e,t){return e.length===t.length&&e.every(function(e,a){var r=t[a];return e.length===r.length&&e.every(function(e,t){return e===r[t]})})}function f(){"ArrowLeft"===event.key&&(r.moveLeft(),o(),l(),"lose"===r.getStatus&&u(),o())}function v(){if("ArrowRight"===event.key){var e=r.getState();r.moveRight();var t=r.getState();o(),l(),r.canCellsMove(r.getState())||u(),c(e,t)||(r.addRandomCell(),o())}}function d(){if("ArrowUp"===event.key){var e=r.getState();r.moveUp();var t=r.getState();o(),l(),r.canCellsMove(r.getState())||u(),c(e,t)||(r.addRandomCell(),o())}}function h(){if("ArrowDown"===event.key){var e=r.getState();r.moveDown();var t=r.getState();o(),l(),r.canCellsMove(r.getState())||u(),c(e,t)||(r.addRandomCell(),o())}}function g(){document.addEventListener("keydown",f),document.addEventListener("keydown",v),document.addEventListener("keydown",d),document.addEventListener("keydown",h)}s.addEventListener("click",function(){if(s.classList.contains("start")){var e=document.querySelector(".message-start");s.classList.remove("start"),s.classList.add("restart"),s.textContent="restart",e.classList.add("hidden");var t=document.querySelector(".game-field").querySelectorAll(".field-cell"),a=r.initialState.flat();document.querySelector(".game-score").textContent=0,t.forEach(function(e,t){a[t]>0&&(e.textContent=a[t],e.classList.add("field-cell--".concat(a[t])))}),r.start(),o(),g()}else r.restart(),document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-win").classList.add("hidden"),s.classList.remove("restart"),s.classList.add("start"),s.textContent="start",o(),g()})}();
//# sourceMappingURL=index.24c193f5.js.map
