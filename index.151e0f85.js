class e{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.state=e,this.initialState=e,this.status="idle",this.score=0}static transposeMatrix(e){return e[0].map((t,s)=>e.map(e=>e[s]))}static ifEqualSeeEach(e){let t=!1,s=[],a=e.every(t=>t===e[0]&&0!==e[0]);for(let l=0;l<e.length-1;l+=1){let r=l+1;if(0===e[r]&&0===e[++r]&&r++,e[l]===e[r]&&0!==e[l]){if(t=!0,s.push(l),s.push(r),!a&&!(e[0]===e[1]&&e[2]===e[3]))break;l++}}return[t,s]}static convertTo2DArray(e){let t=[];for(let s=0;s<4;s++)t.push(e.slice(4*s,4*s+4));return t}static cellsMoveValues(e){let t=0,s=[...e];return s.forEach((e,a,l)=>{0!==e&&(t!==a&&(s[t]=e,l[a]=0),t++)}),s}static are2DArraysEqual(e,t){return e.length===t.length&&e.every((e,s)=>{let a=t[s];return e.length===a.length&&e.every((e,t)=>e===a[t])})}canCellsMove(e){for(let t=0;t<4;t++)for(let s=0;s<4;s++)if(0===e[t][s])return!0;for(let t=0;t<4;t++)for(let s=0;s<4;s++){let a=e[t][s];if(s<3&&a===e[t][s+1]||t<3&&a===e[t+1][s])return!0}return!1}cellsMergeValues(e,t){let s=e+t;return this.score+=s,[s,0]}moveLeft(){if("playing"===this.status){let t=this.getState();this.state=this.state.map(t=>{let s=[...t],a=e.ifEqualSeeEach(s)[0],l=e.ifEqualSeeEach(s)[1];if(a){let e=this.cellsMergeValues(s[l[0]],s[l[1]]);if(s[l[0]]=e[0],s[l[1]]=e[1],4===l.length){let e=this.cellsMergeValues(s[l[2]],s[l[3]]);s[l[2]]=e[0],s[l[3]]=e[1]}}return e.cellsMoveValues(s)});let s=this.getState();e.are2DArraysEqual(t,s)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}moveRight(){if("playing"===this.status){let t=this.getState();this.state=this.state.map(t=>{let s=[...t].reverse(),a=e.ifEqualSeeEach(s)[0],l=e.ifEqualSeeEach(s)[1];if(a){let e=this.cellsMergeValues(s[l[0]],s[l[1]]);if(s[l[0]]=e[0],s[l[1]]=e[1],4===l.length){let e=this.cellsMergeValues(s[l[2]],s[l[3]]);s[l[2]]=e[0],s[l[3]]=e[1]}}return e.cellsMoveValues(s).reverse()});let s=this.getState();e.are2DArraysEqual(t,s)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}moveUp(){if("playing"===this.status){let t=this.getState(),s=this.state,a=e.transposeMatrix(s).map(t=>{let s=e.ifEqualSeeEach(t)[0],a=e.ifEqualSeeEach(t)[1];if(s){let e=this.cellsMergeValues(t[a[0]],t[a[1]]);if(t[a[0]]=e[0],t[a[1]]=e[1],4===a.length){let e=this.cellsMergeValues(t[a[2]],t[a[3]]);t[a[2]]=e[0],t[a[3]]=e[1]}}return e.cellsMoveValues(t)});this.state=e.transposeMatrix(a);let l=this.getState();e.are2DArraysEqual(t,l)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}moveDown(){let t=this.getState();if("playing"===this.status){let s=this.state,a=e.transposeMatrix(s).map(t=>{let s=[...t].reverse(),a=e.ifEqualSeeEach(s)[0],l=e.ifEqualSeeEach(s)[1];if(a){let e=this.cellsMergeValues(s[l[0]],s[l[1]]);if(s[l[0]]=e[0],s[l[1]]=e[1],4===l.length){let e=this.cellsMergeValues(s[l[2]],s[l[3]]);s[l[2]]=e[0],s[l[3]]=e[1]}}return e.cellsMoveValues(s).reverse()});this.state=e.transposeMatrix(a);let l=this.getState();e.are2DArraysEqual(t,l)||this.addRandomCell()}this.getState().flat().includes(2048)&&(this.status="win"),this.canCellsMove(this.getState())||(this.status="lose")}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status="playing",this.addRandomStartCells()}restart(){this.status="idle",this.state=this.initialState,this.score=0}addRandomCell(){let t=this.getState().flat(),s=[];if(t.forEach((e,t)=>{0===e&&s.push(t)}),s.length>0){let a=Math.floor(Math.random()*s.length),l=s[a],r=0;r=.1>=Math.random()?4:2,t[l]=r,this.state=e.convertTo2DArray(t)}}addRandomStartCells(){let t=this.getState().flat(),s=[];if(t.forEach((e,t)=>{0===e&&s.push(t)}),s.length>0){let a=Math.floor(Math.random()*s.length),l=s[a];s.splice(a,1);let r=Math.floor(Math.random()*s.length),i=s[r],n=0,o=0;n=.5>=Math.random()?4:2,o=.5>=Math.random()?4:2,t[l]=n,t[i]=o,this.state=e.convertTo2DArray(t)}}}const t=new e([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),s=document.querySelector(".game-field tbody"),a=document.querySelector(".game-header").querySelector(".button"),l=document.querySelector(".game-score");function r(){s.innerHTML="",t.getState().forEach(e=>{let t=document.createElement("tr");t.classList.add("field-row"),e.forEach(e=>{let s=document.createElement("td");s.classList.add("field-cell"),e>0&&s.classList.add(`field-cell--${e}`),s.textContent=0===e?"":e,t.appendChild(s)}),s.appendChild(t)}),l.textContent=`${t.getScore()}`}function i(){"win"===t.getStatus()&&(document.removeEventListener("keydown",c),document.removeEventListener("keydown",h),document.removeEventListener("keydown",d),document.removeEventListener("keydown",u),document.querySelector(".message-win").classList.remove("hidden"))}function n(){document.querySelector(".message-lose").classList.remove("hidden")}function o(e,t){return e.length===t.length&&e.every((e,s)=>{let a=t[s];return e.length===a.length&&e.every((e,t)=>e===a[t])})}function c(){"ArrowLeft"===event.key&&(t.moveLeft(),r(),i(),"lose"===t.getStatus&&n(),r())}function h(){if("ArrowRight"===event.key){let e=t.getState();t.moveRight();let s=t.getState();r(),i(),t.canCellsMove(t.getState())||n(),o(e,s)||(t.addRandomCell(),r())}}function d(){if("ArrowUp"===event.key){let e=t.getState();t.moveUp();let s=t.getState();r(),i(),t.canCellsMove(t.getState())||n(),o(e,s)||(t.addRandomCell(),r())}}function u(){if("ArrowDown"===event.key){let e=t.getState();t.moveDown();let s=t.getState();r(),i(),t.canCellsMove(t.getState())||n(),o(e,s)||(t.addRandomCell(),r())}}function g(){document.addEventListener("keydown",c),document.addEventListener("keydown",h),document.addEventListener("keydown",d),document.addEventListener("keydown",u)}a.addEventListener("click",function(){if(a.classList.contains("start")){let e=document.querySelector(".message-start");a.classList.remove("start"),a.classList.add("restart"),a.textContent="restart",e.classList.add("hidden");let s=document.querySelector(".game-field").querySelectorAll(".field-cell"),l=t.initialState.flat();document.querySelector(".game-score").textContent=0,s.forEach((e,t)=>{l[t]>0&&(e.textContent=l[t],e.classList.add(`field-cell--${l[t]}`))}),t.start(),r(),g()}else t.restart(),document.querySelector(".message-lose").classList.add("hidden"),document.querySelector(".message-win").classList.add("hidden"),a.classList.remove("restart"),a.classList.add("start"),a.textContent="start",r(),g()});
//# sourceMappingURL=index.151e0f85.js.map
